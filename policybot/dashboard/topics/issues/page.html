<p>
This will display information about GitHub issues.
</p>

<table>
    <thead>
    <tr>
				<th>Repository</th>
				<th>Number</th>
				<th>Title</th>
				<th>State</th>
				<th>AuthorID</th>
				<th>AssigneeIDs</th>
    </tr>
    </thead>
    <tbody id="tbody">
    </tbody>
</table>

<script>
    "use strict";

    function getIssues() {
      let wsurl = "ws://" + window.location.host + "/issuesapi/" + window.location.search;
      if (window.location.protocol === "https:") {
        wsurl = "wss://" + window.location.host + "/issuesapi/" + window.location.search;
      }

      const ws = new WebSocket(wsurl);

      const url = window.location.protocol + "//" + window.location.host + "/issuesapi/";
      const tbody = document.getElementById("tbody");

      ws.onmessage = evt => {
        console.log(evt)

        const issues = JSON.parse(evt.data);

				for (let i = 0; i < issues.length; i++) {
				  const row = document.createElement("tr");

				  const repoCell = document.createElement("td");
				  repoCell.innerText = issues[i].repo;
				  row.appendChild(repoCell);

  		    const numberCell = document.createElement("td");
	  	    numberCell.innerText = issues[i].number;
		      row.appendChild(numberCell);

			    const titleCell = document.createElement("td");
			    titleCell.innerText = issues[i].title;
					row.appendChild(titleCell);

					const stateCell = document.createElement("td");
					stateCell.innerText = issues[i].state;
					row.appendChild(stateCell);

					const authorLoginCell = document.createElement("td");
					authorLoginCell.innerText = issues[i].author_login;
					row.appendChild(authorLoginCell);

					const assigneesCell = document.createElement("td");
					assigneesCell.innerText = issues[i].assignees;
					row.appendChild(assigneesCell);

				  tbody.appendChild(row);
			  }
      }
    }

    getIssues();
</script>
